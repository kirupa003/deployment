VPN Server Provisioning Report
==============================

Server Information:
- Hostname: {{ inventory_hostname }}
- IP Address: {{ ansible_default_ipv4.address }}
- Region: {{ server_region }}
- Protocols: {{ server_protocols | join(', ') }}
- Capacity: {{ server_capacity }} connections

System Details:
- OS: {{ ansible_distribution }} {{ ansible_distribution_version }}
- Kernel: {{ ansible_kernel }}
- Architecture: {{ ansible_architecture }}
- CPU Cores: {{ ansible_processor_vcpus }}
- Memory: {{ ansible_memtotal_mb }} MB
- Disk Space: {{ ansible_mounts | selectattr('mount', 'equalto', '/') | map(attribute='size_total') | first | filesizeformat }}

Provisioning Status:
- Started: {{ server_metadata.provisioned_at }}
- Completed: {{ ansible_date_time.iso8601 }}
- Duration: {{ ((ansible_date_time.epoch | int) - (server_metadata.provisioned_at | to_datetime('%Y-%m-%dT%H:%M:%SZ') | int)) // 60 }} minutes
- Provisioned by: {{ server_metadata.provisioned_by }}
- Ansible Version: {{ server_metadata.ansible_version }}

Installed Services:
{% for protocol in server_protocols %}
- {{ protocol | title }} VPN Service
{% endfor %}
- Node Exporter (Monitoring)
- Promtail (Log Shipping)
- CrowdSec (Security)
- Fail2Ban (Intrusion Prevention)
- UFW Firewall

Health Check Results:
{% if health_check_results is defined %}
- Connectivity: {{ 'PASS' if health_check_results.connectivity else 'FAIL' }}
- Services Active: {{ health_check_results.services_up }}/{{ health_check_results.total_services }}
- Network Interfaces: {{ health_check_results.interfaces_up }} active
- Available Space: {{ (health_check_results.available_space_kb | int / 1024 / 1024) | round(2) }} GB
- Firewall Status: {{ 'ACTIVE' if health_check_results.firewall_active else 'INACTIVE' }}
- Port Accessibility: {{ health_check_results.ports_accessible }} ports accessible
- Metrics Endpoints: {{ health_check_results.metrics_accessible }} endpoints responding
{% else %}
- Health check not performed or failed
{% endif %}

Network Configuration:
- SSH Port: 22
{% if 'wireguard' in server_protocols %}
- WireGuard Port: 51820/UDP
- WireGuard Dashboard: 10086/TCP
{% endif %}
{% if 'openvpn' in server_protocols %}
- OpenVPN Port: 1194/UDP,TCP
{% endif %}
- Monitoring Port: 9100/TCP (node_exporter)

Security Configuration:
- SSH Key Authentication: Enabled
- Root Login: Disabled
- Password Authentication: Disabled
- UFW Firewall: Enabled
- Fail2Ban: Active
- CrowdSec: Connected

Next Steps:
1. Verify VPN connectivity from client devices
2. Monitor server metrics in Grafana dashboard
3. Configure client access and user management
4. Set up automated backups and monitoring alerts

Report Generated: {{ ansible_date_time.iso8601 }}
Generated by: Ansible VPN Infrastructure Controller