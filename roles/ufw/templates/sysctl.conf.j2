# UFW sysctl configuration
# Generated by Ansible - DO NOT EDIT MANUALLY

#
# Configuration file for setting network variables. Please note these settings
# override /etc/sysctl.conf and /etc/sysctl.d. If you prefer to use
# /etc/sysctl.conf, please adjust IPT_SYSCTL in /etc/default/ufw. See
# Documentation/networking/ip-sysctl.txt in the kernel source code for more
# information.
#

# Ignore ICMP redirects
net/ipv4/conf/all/accept_redirects=0
net/ipv4/conf/default/accept_redirects=0
net/ipv6/conf/all/accept_redirects=0
net/ipv6/conf/default/accept_redirects=0

# Ignore send redirects
net/ipv4/conf/all/send_redirects=0
net/ipv4/conf/default/send_redirects=0

# Disable source packet routing
net/ipv4/conf/all/accept_source_route=0
net/ipv4/conf/default/accept_source_route=0
net/ipv6/conf/all/accept_source_route=0
net/ipv6/conf/default/accept_source_route=0

# Log Martians
net/ipv4/conf/all/log_martians=1

# Ignore ICMP ping requests
net/ipv4/icmp_echo_ignore_all=0

# Ignore Directed pings
net/ipv4/icmp_echo_ignore_broadcasts=1

# Disable IPv6 if not needed
{% if not (ipv6_enabled | default(true)) %}
net/ipv6/conf/all/disable_ipv6=1
net/ipv6/conf/default/disable_ipv6=1
net/ipv6/conf/lo/disable_ipv6=1
{% endif %}

# Enable IP forwarding for VPN
{% if vpn_server_enabled | default(true) %}
net/ipv4/ip_forward=1
{% if ipv6_enabled | default(true) %}
net/ipv6/conf/all/forwarding=1
{% endif %}
{% else %}
net/ipv4/ip_forward=0
{% if ipv6_enabled | default(true) %}
net/ipv6/conf/all/forwarding=0
{% endif %}
{% endif %}

# Enable syn flood protection
net/ipv4/tcp_syncookies=1

# Increase the maximum amount of option memory buffers
net/core/optmem_max=65536

# Increase the tcp-time-wait buckets pool size to prevent simple DOS attacks
net/ipv4/tcp_max_tw_buckets=1440000

# try to reuse time-wait connections, but don't recycle them (recycle can break clients behind NAT)
net/ipv4/tcp_tw_reuse=1

# Limit number of orphans, each orphan can eat up to 16M (max wmem) of unswappable memory
net/ipv4/tcp_max_orphans=16384

# Increase the maximum memory used to reassemble IP fragments
net/ipv4/ipfrag_high_thresh=512000
net/ipv4/ipfrag_low_thresh=446464

# don't cache ssthresh from previous connection
net/ipv4/tcp_no_metrics_save=1
net/ipv4/tcp_moderate_rcvbuf=1

# Increase size of RPC datagram queue length
net/unix/max_dgram_qlen=50

# Don't allow the arp table to become bigger than this
net/ipv4/neigh/default/gc_thresh3=2048

# Tell the gc when to become aggressive with arp table cleaning.
# Adjust this based on size of the LAN. 1024 is suitable for most /24 networks
net/ipv4/neigh/default/gc_thresh2=1024

# Adjust where the gc will leave arp table alone - set to 32.
net/ipv4/neigh/default/gc_thresh1=32

# Adjust to arp table gc to clean-up more often
net/ipv4/neigh/default/gc_interval=30

# Increase TCP queue length
net/ipv4/neigh/default/proxy_qlen=96
net/ipv4/neigh/default/unres_qlen=6

# Enable a fix for RFC1337 - time-wait assassination hazards in TCP
net/ipv4/tcp_rfc1337=1

# Do not auto-configure IPv6
{% if not (ipv6_enabled | default(true)) %}
net/ipv6/conf/all/autoconf=0
net/ipv6/conf/default/autoconf=0
net/ipv6/conf/all/accept_ra=0
net/ipv6/conf/default/accept_ra=0
{% endif %}