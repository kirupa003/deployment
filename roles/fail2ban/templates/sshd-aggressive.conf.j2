# Fail2Ban filter for SSH (Aggressive)
# Generated by Ansible - DO NOT EDIT MANUALLY

[INCLUDES]

# Read common prefixes. If any customizations available -- read them from
# common.local
before = common.conf

[Definition]

_daemon = sshd

# Option: failregex
# Notes.: regex to match the password failures messages in the logfile. The
#         host must be matched by a group named "host". The tag "<HOST>" can
#         be used for standard IP/hostname matching and is only an alias for
#         (?:::f{4,6}:)?(?P<host>[\w\-.^_]+)
# Values: TEXT
#
failregex = ^%(__prefix_line)s(?:error: PAM: )?[aA]uthentication (?:failure|error|failed) for .* from <HOST>( via \S+)?\s*$
            ^%(__prefix_line)s(?:error: )?Received disconnect from <HOST>: 3: .*: Auth fail$
            ^%(__prefix_line)sFailed \S+ for (?P<cond_inv>invalid user )?(?P<cond_user>\S+)(?: from <HOST>)?(?: port \d+)?(?: ssh\d*)?(?:: (?:ruser .*|(\S+ ID \S+ \(serial \d+\) CA )?\S+ %(__md5hex)s(, client user ".*", client host ".*")?))?\s*$
            ^%(__prefix_line)sROOT LOGIN REFUSED.* FROM <HOST>\s*$
            ^%(__prefix_line)s[iI](?:llegal|nvalid) user .*? from <HOST>(?: port \d+)?\s*$
            ^%(__prefix_line)sUser .+ from <HOST> not allowed because not listed in AllowUsers\s*$
            ^%(__prefix_line)sUser .+ from <HOST> not allowed because listed in DenyUsers\s*$
            ^%(__prefix_line)sUser .+ from <HOST> not allowed because not in any group\s*$
            ^%(__prefix_line)srefused connect from \S+ \(<HOST>\)\s*$
            ^%(__prefix_line)s(?:error: )?Received disconnect from <HOST>: 14: No supported authentication methods available$
            ^%(__prefix_line)s(?:error: )?Received disconnect from <HOST>: 11: Bye Bye$
            ^%(__prefix_line)s(?:error: )?Connection closed by <HOST>(?: port \d+)? \[preauth\]\s*$
            ^%(__prefix_line)s(?:error: )?Connection reset by <HOST>(?: port \d+)? \[preauth\]\s*$
            ^%(__prefix_line)s(?:error: )?maximum authentication attempts exceeded for .* from <HOST>(?: port \d+)?(?: ssh\d*)? \[preauth\]\s*$
            ^%(__prefix_line)s(?:error: )?User .+ not allowed because account is locked from <HOST>\s*$
            ^%(__prefix_line)s(?:error: )?Disconnecting: Too many authentication failures for .+ \[preauth\]\s*$
            ^%(__prefix_line)s(?:error: )?Connection from <HOST> port \d+ on \S+ port \d+ refused: too many authentication failures\s*$
            ^%(__prefix_line)s(?:error: )?Bad protocol version identification '.*' from <HOST>\s*$
            ^%(__prefix_line)s(?:error: )?kex_exchange_identification: .*Connection closed by remote host from <HOST>\s*$
            ^%(__prefix_line)s(?:error: )?Unable to negotiate with <HOST>: no matching .*$
            ^%(__prefix_line)s(?:error: )?Did not receive identification string from <HOST>\s*$
            ^%(__prefix_line)s(?:error: )?SSH: Server;Ltype: Version;Remote: <HOST>-\d+;Protocol: \d+\.\d+;Client: .*$
            ^%(__prefix_line)s(?:error: )?Bad packet length \d+\. \[preauth\] from <HOST>\s*$
            ^%(__prefix_line)s(?:error: )?fatal: no matching mac found: client .* server .* \[preauth\] from <HOST>\s*$

# Option: ignoreregex
# Notes.: regex to ignore. If this regex matches, the line is ignored.
# Values: TEXT
#
ignoreregex = 

[Init]

journalmatch = _SYSTEMD_UNIT=sshd.service + _COMM=sshd

# Author: Cyril Jaquier