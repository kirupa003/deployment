# Fail2Ban jail configuration
# Generated by Ansible - DO NOT EDIT MANUALLY

[DEFAULT]
# Ban hosts for one hour:
bantime = {{ fail2ban_bantime }}

# Override /etc/fail2ban/jail.d/00-firewalld.conf:
banaction = iptables-multiport

# A host is banned if it has generated "maxretry" during the last "findtime"
# seconds.
findtime = {{ fail2ban_findtime }}

# "maxretry" is the number of failures before a host get banned.
maxretry = {{ fail2ban_maxretry }}

# "backend" specifies the backend used to get files modification.
backend = {{ fail2ban_backend }}

# Destination email address used solely for the interpolations in
# jail.{conf,local,d/*} configuration files.
destemail = {{ fail2ban_destemail }}

# Sender email address used solely for some actions
sender = {{ fail2ban_sender }}

# E-mail action. Since 0.8.1 Fail2Ban uses sendmail MTA for the
# mailing. To use another MTA (mail command) change mta configuration option.
mta = {{ fail2ban_mta }}

# Default protocol
protocol = tcp

# Specify chain where jumps would need to be added in iptables-* actions
chain = INPUT

# Ports to be banned
# Usually should be overridden in a particular jail
port = 0:65535

# Action shortcuts. To be used to define action parameter
action_ = %(banaction)s[name=%(__name__)s, bantime="%(bantime)s", port="%(port)s", protocol="%(protocol)s", chain="%(chain)s"]
action_mw = %(banaction)s[name=%(__name__)s, bantime="%(bantime)s", port="%(port)s", protocol="%(protocol)s", chain="%(chain)s"]
            %(mta)s-whois[name=%(__name__)s, sender="%(sender)s", dest="%(destemail)s", protocol="%(protocol)s", chain="%(chain)s"]
action_mwl = %(banaction)s[name=%(__name__)s, bantime="%(bantime)s", port="%(port)s", protocol="%(protocol)s", chain="%(chain)s"]
             %(mta)s-whois-lines[name=%(__name__)s, sender="%(sender)s", dest="%(destemail)s", logpath="%(logpath)s", chain="%(chain)s"]

# Choose default action.  To change, just override value of 'action' with the
# interpolation to the chosen action shortcut (e.g.  action_mw, action_mwl, etc) in jail.local
# globally (section [DEFAULT]) or per specific section
action = {{ fail2ban_action }}

# Ignore IP list
ignoreip = {{ fail2ban_ignoreip | join(' ') }}

#
# JAILS
#

{% if fail2ban_ssh_enabled %}
[sshd]
enabled = true
port = {{ fail2ban_ssh_port }}
filter = sshd-aggressive
logpath = {{ fail2ban_ssh_logpath }}
maxretry = {{ fail2ban_ssh_maxretry }}
bantime = {{ fail2ban_ssh_bantime }}
findtime = {{ fail2ban_ssh_findtime }}
{% endif %}

{% if fail2ban_openvpn_enabled %}
[openvpn]
enabled = true
port = {{ fail2ban_openvpn_port }}
protocol = {{ fail2ban_openvpn_protocol }}
filter = openvpn-custom
logpath = {{ fail2ban_openvpn_logpath }}
maxretry = {{ fail2ban_openvpn_maxretry }}
bantime = {{ fail2ban_openvpn_bantime }}
findtime = {{ fail2ban_openvpn_findtime }}
{% endif %}

{% if fail2ban_wireguard_enabled %}
[wireguard]
enabled = true
port = {{ fail2ban_wireguard_port }}
protocol = {{ fail2ban_wireguard_protocol }}
filter = wireguard
logpath = {{ fail2ban_wireguard_logpath }}
maxretry = {{ fail2ban_wireguard_maxretry }}
bantime = {{ fail2ban_wireguard_bantime }}
findtime = {{ fail2ban_wireguard_findtime }}
{% endif %}

{% if fail2ban_recidive_enabled %}
[recidive]
enabled = true
filter = recidive
logpath = {{ fail2ban_recidive_logpath }}
action = iptables-allports[name=recidive]
bantime = {{ fail2ban_recidive_bantime }}
findtime = {{ fail2ban_recidive_findtime }}
maxretry = {{ fail2ban_recidive_maxretry }}
{% endif %}

{% if fail2ban_apache_enabled %}
[apache-auth]
enabled = true
port = http,https
filter = apache-auth
logpath = /var/log/apache*/*error.log
maxretry = 6

[apache-badbots]
enabled = true
port = http,https
filter = apache-badbots
logpath = /var/log/apache*/*access.log
bantime = 172800
maxretry = 1
{% endif %}

{% if fail2ban_nginx_enabled %}
[nginx-http-auth]
enabled = true
port = http,https
filter = nginx-http-auth
logpath = /var/log/nginx/error.log
maxretry = 6

[nginx-noscript]
enabled = true
port = http,https
filter = nginx-noscript
logpath = /var/log/nginx/access.log
maxretry = 6

[nginx-badbots]
enabled = true
port = http,https
filter = nginx-badbots
logpath = /var/log/nginx/access.log
bantime = 86400
maxretry = 1

[nginx-noproxy]
enabled = true
port = http,https
filter = nginx-noproxy
logpath = /var/log/nginx/access.log
maxretry = 2
{% endif %}

{% if fail2ban_postfix_enabled %}
[postfix]
enabled = true
port = smtp,465,submission
filter = postfix
logpath = /var/log/mail.log

[postfix-sasl]
enabled = true
port = smtp,465,submission,imap3,imaps,pop3,pop3s
filter = postfix-sasl
logpath = /var/log/mail.log
{% endif %}