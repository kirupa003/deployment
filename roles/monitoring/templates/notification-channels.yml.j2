# Notification Channels Configuration
# Generated by Ansible - Do not edit manually

apiVersion: 1

notifiers:
{% if monitoring_slack_webhook_url != "" %}
  - name: vpn-alerts-slack
    type: slack
    uid: vpn_slack_notifications
    org_id: 1
    is_default: true
    send_reminder: true
    disable_resolve_message: false
    frequency: "10m"
    settings:
      url: {{ monitoring_slack_webhook_url }}
      channel: {{ monitoring_slack_channel }}
      title: "VPN Infrastructure Alert"
      text: |
        {{ '{{' }} range .Alerts {{ '}}' }}
        *Alert:* {{ '{{' }} .Annotations.summary {{ '}}' }}
        *Description:* {{ '{{' }} .Annotations.description {{ '}}' }}
        *Severity:* {{ '{{' }} .Labels.severity {{ '}}' }}
        *Instance:* {{ '{{' }} .Labels.instance {{ '}}' }}
        {{ '{{' }} end {{ '}}' }}
      username: "Grafana"
      icon_emoji: ":exclamation:"

{% endif %}
{% if monitoring_pagerduty_integration_key != "" %}
  - name: vpn-alerts-pagerduty
    type: pagerduty
    uid: vpn_pagerduty_notifications
    org_id: 1
    send_reminder: true
    disable_resolve_message: false
    frequency: "5m"
    settings:
      integrationKey: {{ monitoring_pagerduty_integration_key }}
      severity: error
      class: "VPN Infrastructure"
      component: "VPN Server"
      group: "Infrastructure"

{% endif %}
{% if monitoring_email_addresses | length > 0 %}
  - name: vpn-alerts-email
    type: email
    uid: vpn_email_notifications
    org_id: 1
    send_reminder: true
    disable_resolve_message: false
    frequency: "15m"
    settings:
      addresses: {{ monitoring_email_addresses | join(';') }}
      subject: "VPN Infrastructure Alert - {{ '{{' }} .CommonLabels.alertname {{ '}}' }}"
      body: |
        Alert Details:
        
        {{ '{{' }} range .Alerts {{ '}}' }}
        Alert: {{ '{{' }} .Annotations.summary {{ '}}' }}
        Description: {{ '{{' }} .Annotations.description {{ '}}' }}
        Severity: {{ '{{' }} .Labels.severity {{ '}}' }}
        Instance: {{ '{{' }} .Labels.instance {{ '}}' }}
        Started: {{ '{{' }} .StartsAt {{ '}}' }}
        {{ '{{' }} end {{ '}}' }}

{% endif %}