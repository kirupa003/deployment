#!/bin/bash
# WireGuard QR Code Generation Script
# Generated by Ansible

set -euo pipefail

CLIENT_NAME="$1"
CLIENT_CONFIG_DIR="{{ client_config_dir }}"
CLIENT_QR_DIR="{{ client_qr_dir }}"

if [[ -z "$CLIENT_NAME" ]]; then
    echo "Usage: $0 <client_name>"
    exit 1
fi

if [[ ! -f "$CLIENT_CONFIG_DIR/active/$CLIENT_NAME.conf" ]]; then
    echo "Error: Client configuration not found: $CLIENT_NAME"
    exit 1
fi

# Generate QR code in terminal
echo "QR Code for client '$CLIENT_NAME':"
qrencode -t ansiutf8 < "$CLIENT_CONFIG_DIR/active/$CLIENT_NAME.conf"

# Generate PNG QR code
qrencode -t png -o "$CLIENT_QR_DIR/$CLIENT_NAME.png" < "$CLIENT_CONFIG_DIR/active/$CLIENT_NAME.conf"

echo ""
echo "QR code saved to: $CLIENT_QR_DIR/$CLIENT_NAME.png"