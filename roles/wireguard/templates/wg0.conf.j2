# WireGuard Server Configuration
# Generated by Ansible on {{ ansible_date_time.iso8601 }}

[Interface]
# Server private key
PrivateKey = {{ wireguard_server_private_key }}

# Server IP address within the VPN network
Address = {{ wireguard_server_ip }}/{{ wireguard_network.split('/')[1] }}

# Port to listen on
ListenPort = {{ wireguard_port }}

# MTU for the interface
MTU = {{ wireguard_mtu }}

# DNS servers for clients
{% if wireguard_dns is string %}
DNS = {{ wireguard_dns }}
{% else %}
DNS = {{ wireguard_dns | join(', ') }}
{% endif %}

# Post-up and post-down scripts for NAT and routing
PostUp = iptables -A FORWARD -i %i -j ACCEPT; iptables -A FORWARD -o %i -j ACCEPT; iptables -t nat -A POSTROUTING -o {{ wireguard_forward_interface }} -j MASQUERADE
PostDown = iptables -D FORWARD -i %i -j ACCEPT; iptables -D FORWARD -o %i -j ACCEPT; iptables -t nat -D POSTROUTING -o {{ wireguard_forward_interface }} -j MASQUERADE

# Client configurations will be added here by the dashboard or management scripts
# Each client will have a [Peer] section with their public key and allowed IPs