---
# WireGuard Role Main Tasks

- name: Include OS-specific variables
  include_vars: "{{ ansible_os_family }}.yml"
  failed_when: false

- name: Validate WireGuard configuration
  include_tasks: validate.yml

- name: Install WireGuard packages
  include_tasks: install.yml

- name: Configure system parameters
  include_tasks: system.yml

- name: Generate WireGuard keys
  include_tasks: keys.yml

- name: Configure WireGuard server
  include_tasks: configure.yml

- name: Setup firewall rules
  include_tasks: firewall.yml
  when: wireguard_firewall_enabled

- name: Install Docker for dashboard
  include_tasks: docker.yml
  when: wg_dashboard_enabled

- name: Deploy WireGuard dashboard
  include_tasks: dashboard.yml
  when: wg_dashboard_enabled

- name: Setup client management
  include_tasks: clients.yml

- name: Start and enable WireGuard service
  include_tasks: service.yml

- name: Verify WireGuard installation
  include_tasks: verify.yml